{% extends 'tours/base.html' %}

{% load cache %}

{% block title %}Tours - Safarnama{% endblock %}

{% block content %}

{% load static %}
<link rel="stylesheet" href="{% static 'tours/css/tours_list.css' %}">

<h2 class="page-heading">Explore Our Tour Packages</h2>

<!-- ðŸ” FILTER BAR -->
<form method="get" class="filter-bar">
  <input type="text" name="q" placeholder="Search tours..." value="{{ request.GET.q }}">
  
  <select name="destination">
    <option value="">All Destinations</option>
    {% for dest in destinations %}
      <option value="{{ dest }}" {% if request.GET.destination == dest %}selected{% endif %}>{{ dest }}</option>
    {% endfor %}
  </select>

  <input type="number" name="price_min" placeholder="Min â‚¹" value="{{ request.GET.price_min }}">
  <input type="number" name="price_max" placeholder="Max â‚¹" value="{{ request.GET.price_max }}">

  <button type="submit">Filter</button>
</form>

{% if tours %}

<div class="tour-grid">
  {% for tour in tours %}
    
    {% cache 300 tour_card tour.id %}
      {% include 'tours/tour_card.html' with tour=tour %}
    {% endcache %}
  
  {% endfor %}
</div>

<!-- Pagination -->
<div class="pagination">
  {% if tours.has_previous %}
    <a href="?page={{ tours.previous_page_number }}">&laquo; Prev</a>
  {% endif %}

  {% for page_num in tours.paginator.page_range %}
    {% if page_num == tours.number %}
      <span class="active-page">{{ page_num }}</span>
    {% elif page_num > tours.number|add:'-3' and page_num < tours.number|add:'3' %}
      <a href="?page={{ page_num }}">{{ page_num }}</a>
    {% endif %}
  {% endfor %}

  {% if tours.has_next %}
    <a href="?page={{ tours.next_page_number }}">Next &raquo;</a>
  {% endif %}
</div>

{% else %}
  <p class="no-tours">No tours found.</p>
{% endif %}

{% endblock %}
